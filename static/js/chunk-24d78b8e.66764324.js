(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-24d78b8e"],{"0a6c":function(e,t,a){"use strict";a.r(t);var n=function(){var e,t,a=this,n=a._self._c;return n("div",{staticClass:"page-wrapper"},[n("div",{staticClass:"table-wrapper"},[n("el-tabs",{attrs:{type:"border-card"}},[n("el-tab-pane",{attrs:{label:"send email"}},[n("div",{staticClass:"add-wrapper"},[n("el-form",{ref:"ruleForm",attrs:{model:a.ruleForm,rules:a.rules,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"mail title",prop:"title",rules:a.rules.blur}},[n("el-input",{model:{value:a.ruleForm.title,callback:function(e){a.$set(a.ruleForm,"title",e)},expression:"ruleForm.title"}})],1),n("el-form-item",{attrs:{label:"Select mailbox",prop:"emailId",rules:a.rules.select}},[n("div",{staticClass:"email-box"},[n("el-select",{staticStyle:{width:"75%"},attrs:{multiple:"",placeholder:"please choose"},model:{value:a.ruleForm.emailId,callback:function(e){a.$set(a.ruleForm,"emailId",e)},expression:"ruleForm.emailId"}},a._l(a.emailList,(function(e){return n("el-option",{key:e.id,attrs:{label:e.emailUser,value:e.id}})})),1),n("p",{staticClass:"residue-box"},[a._v("Remaining quota"+a._s(a.remainingAmount))])],1)]),n("el-form-item",{attrs:{label:"recipient",prop:"sendUser",rules:a.rules.select}},[n("div",{staticClass:"flex"},[n("el-radio-group",{on:{change:a.sendUserTypeChange},model:{value:a.ruleForm.sendUser,callback:function(e){a.$set(a.ruleForm,"sendUser",e)},expression:"ruleForm.sendUser"}},[n("el-radio",{attrs:{label:"all"}},[a._v("All users")]),n("el-radio",{attrs:{label:"part"}},[a._v(" customize ")])],1),"part"==a.ruleForm.sendUser?n("div",{staticClass:"user-select"},[0==(null===(e=a.fileUserList)||void 0===e?void 0:e.length)||a.ruleForm.subscribe&&0==(null===(t=a.userList)||void 0===t?void 0:t.length)?[n("el-upload",{staticClass:"upload-demo",attrs:{action:"/","on-change":a.handleChange}},[n("el-button",{attrs:{size:"small",type:"primary",plain:""}},[a._v("Upload user list")])],1),n("el-tooltip",{attrs:{content:"Please fill in the user ID in the first column of XLS",placement:"bottom",effect:"light"}},[n("el-button",{staticStyle:{"margin-left":"5px"},attrs:{size:"small",type:"info",plain:""},on:{click:a.downloadTemplate}},[a._v("Download template")])],1)]:n("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:a.getSendEmailUserListFunc}},[a._v("View user list")])],2):a._e()],1)]),n("el-form-item",{attrs:{label:"Without a copy",prop:"subscribe"}},[n("el-switch",{on:{change:a.subscribeChange},model:{value:a.ruleForm.subscribe,callback:function(e){a.$set(a.ruleForm,"subscribe",e)},expression:"ruleForm.subscribe"}})],1),n("el-form-item",{attrs:{label:"content",prop:"content",rules:a.rules.select}},[n("el-upload",{staticClass:"upload-demo",attrs:{action:"/","on-change":a.contentHandleChange}},[n("el-button",{attrs:{size:"small",type:"primary",plain:""}},[a._v("upload files")])],1)],1),n("el-form-item",{attrs:{label:"Preview"}},[n("div",{staticClass:"content-view"},[n("div",{domProps:{innerHTML:a._s(a.ruleForm.content)}})])]),n("el-form-item",{attrs:{label:"send"}},[n("el-col",{attrs:{span:6}},[n("el-button",{attrs:{type:"primary"},on:{click:function(e){return a.submitForm()}}},[a._v("send immediately")])],1),n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{prop:"sendTimeStr"}},[n("div",{staticClass:"flex"},[n("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:"Selection date time","picker-options":a.pickerOptions},model:{value:a.ruleForm.sendTimeStr,callback:function(e){a.$set(a.ruleForm,"sendTimeStr",e)},expression:"ruleForm.sendTimeStr"}}),n("el-button",{attrs:{type:"primary"},on:{click:function(e){return a.submitForm("timing")}}},[a._v("Timely sending")])],1)])],1)],1)],1)],1)]),n("el-tab-pane",{attrs:{label:"E -mail history"}},[n("el-table",{attrs:{data:a.sendEmailList,border:"",height:"75vh"}},[n("el-table-column",{key:"1",attrs:{prop:"id",label:"Email ID",align:"center"}}),n("el-table-column",{attrs:{prop:"title",label:"mail title",align:"center","show-overflow-tooltip":""}}),n("el-table-column",{attrs:{prop:"content",label:"content of email",align:"center","show-overflow-tooltip":""},scopedSlots:a._u([{key:"default",fn:function(e){return[n("span",{staticClass:"blueColor publick-button cursor",on:{click:function(t){return a.emailContentShow(e.row.content)}}},[a._v(" Check ")])]}}])}),n("el-table-column",{attrs:{prop:"sendUser",label:"recipient",align:"center","show-overflow-tooltip":""},scopedSlots:a._u([{key:"default",fn:function(e){return["all"==e.row.sendUser?n("div",[a._v("All users")]):"subscribe"==e.row.sendUser?n("div",[a._v("Subscriber")]):n("div",[a._v("customize")])]}}])}),n("el-table-column",{attrs:{prop:"sendUserTotal",label:"Number of senders",align:"center"}}),n("el-table-column",{attrs:{prop:"sendNum",label:"Has been sent",align:"center"}}),n("el-table-column",{attrs:{prop:"createTime",label:"Send time",align:"center"},scopedSlots:a._u([{key:"default",fn:function(e){return[n("div",[a._v(" "+a._s(a.timeForStr(e.row.sendTime,"YYYY-MM-DD HH:mm:ss"))+" ")])]}}])}),n("el-table-column",{attrs:{prop:"contractAddress",label:"state",align:"center"},scopedSlots:a._u([{key:"default",fn:function(e){return["0"==e.row.sendType?n("div",{staticStyle:{color:"#e6a23c"}},[a._v("Wait")]):"1"==e.row.sendType?n("div",{staticStyle:{color:"#67c23a"}},[a._v(" Has been sent ")]):n("div",{staticStyle:{color:"#909399"}},[a._v(" Cancelled ")])]}}])}),n("el-table-column",{attrs:{prop:"id",label:"operate",align:"center",width:"110"},scopedSlots:a._u([{key:"default",fn:function(e){return[n("span",{staticClass:"blueColor publick-button cursor",on:{click:function(t){return a.getSendMailUserFunc(e.row)}}},[a._v(" View users ")]),"0"==e.row.sendType?n("span",{staticClass:"blueColor publick-button cursor",on:{click:function(t){return a.operatingFunc(e.row,"cancel")}}},[a._v(" Cancel ")]):n("span",{staticClass:"blueColor publick-button cursor",on:{click:function(t){return a.operatingFunc(e.row,"del")}}},[a._v(" delete ")])]}}])})],1),a.baseUserPage&&a.baseUserPage.total?n("el-pagination",{staticClass:"public-pagination",attrs:{background:"","current-page":a.page,"page-sizes":a.pagination.pageSizes,"page-size":a.size,layout:" sizes, prev, pager, next, jumper",total:a.baseUserPage.total},on:{"size-change":a.handleSizeChange,"current-change":a.handleCurrentChange}}):a._e()],1)],1)],1),n("el-dialog",{attrs:{title:"user list",visible:a.dialogVisible,width:"40%"},on:{"update:visible":function(e){a.dialogVisible=e},close:a.handleClose}},[n("el-table",{attrs:{data:a.userList,border:""}},[n("el-table-column",{attrs:{prop:"id",label:"User ID",align:"center"}}),n("el-table-column",{attrs:{prop:"userName",label:"User's Nickname",align:"center"}}),n("el-table-column",{attrs:{prop:"email",label:"Mail",align:"center"}}),a.showUserList?n("el-table-column",{attrs:{prop:"balance",label:"Balance",align:"center"}}):a._e()],1),a.userTotal>0&&a.showUserList?n("el-pagination",{staticClass:"public-pagination",attrs:{background:"","current-page":a.userPage,"page-sizes":a.pagination.pageSizes,"page-size":a.userSize,layout:" sizes, prev, pager, next, jumper",total:a.userTotal},on:{"size-change":a.handleSizeChangeUser,"current-change":a.handleCurrentChangeUser}}):a._e(),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:function(e){a.dialogVisible=!1}}},[a._v("Sure")])],1)],1),n("el-dialog",{attrs:{title:"content of email",visible:a.dialogVisible2,width:"40%"},on:{"update:visible":function(e){a.dialogVisible2=e}}},[n("div",{staticClass:"content-view",domProps:{innerHTML:a._s(a.emailContent)}}),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:function(e){a.dialogVisible2=!1}}},[a._v("Sure")])],1)])],1)},r=[],s=a("5530"),i=a("c7eb"),l=a("1da1"),o=(a("caad"),a("a15b"),a("d81d"),a("13d5"),a("ace4"),a("2c66"),a("249d"),a("40e9"),a("d3b7"),a("2532"),a("3ca3"),a("5cc6"),a("907a"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("986a"),a("1d02"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("6ce5"),a("2834"),a("72f7"),a("4ea1"),a("ddb0"),a("2b3d"),a("bf19"),a("9861"),a("88a7"),a("271a"),a("5494"),a("1b80")),c=a("1146"),u=a.n(c),d=a("ed08"),p={name:"Email",data:function(){return{pickerOptions:{disabledDate:function(e){var t=new Date;return t.setHours(0,0,0,0),e.getTime()<t.getTime()}},Id:null,marketName:null,marketStatus:null,page:1,size:20,tableData:null,baseUserPage:null,sendEmailList:[],emailList:[],ruleForm:{title:"",emailId:[],sendUser:"",content:"",sendTimeStr:"",subscribe:!1},fileUserList:[],userList:[],dialogVisible:!1,dialogVisible2:!1,rules:{blur:[{required:!0,message:"please enter",trigger:"blur"}],select:[{required:!0,message:"please choose",trigger:"change"}]},sendAmount:0,userTotal:0,userPage:1,userSize:20,showUserList:!1,emailContent:null}},mixins:[o["a"]],computed:{remainingAmount:function(){var e,t=this;return(null===(e=this.ruleForm.emailId)||void 0===e?void 0:e.length)>0?this.emailList.reduce((function(e,a){return t.ruleForm.emailId.includes(a.id)?e+a.maxNumberDay-a.sendNumber:e}),0):0}},created:function(){this.getEmailListFunc(),this.getSendEmailListFunc()},methods:{timeForStr:d["h"],downloadTemplate:function(){var e=u.a.utils.book_new(),t=u.a.utils.json_to_sheet([]);u.a.utils.book_append_sheet(e,t,"Sheet1");var a=u.a.write(e,{bookType:"xlsx",type:"array"}),n=new Blob([a],{type:"application/octet-stream"}),r=window.URL.createObjectURL(n),s=document.createElement("a");s.href=r,s.setAttribute("download","user list.xlsx"),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(r)},getSendEmailListFunc:function(){var e=this;return Object(l["a"])(Object(i["a"])().mark((function t(){var a,n,r;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.size,n=e.page,t.next=3,e.$http.getSendEmailPageList({size:a,page:n});case 3:r=t.sent,r&&(e.baseUserPage=r,e.sendEmailList=r.records);case 5:case"end":return t.stop()}}),t)})))()},sendUserTypeChange:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function a(){var n;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.fileUserList=[],"part"==e){a.next=6;break}return a.next=4,t.$http.getSendEmailUserTotal({type:e});case 4:n=a.sent,t.sendAmount=n;case 6:case"end":return a.stop()}}),a)})))()},getEmailListFunc:function(){var e=this;return Object(l["a"])(Object(i["a"])().mark((function t(){var a;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.getSendEmailList();case 2:a=t.sent,a&&(e.emailList=a);case 4:case"end":return t.stop()}}),t)})))()},getSendEmailUserListFunc:function(){var e=this;return Object(l["a"])(Object(i["a"])().mark((function t(){var a,n,r,s;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0!=(null===(a=e.fileUserList)||void 0===a?void 0:a.length)){t.next=2;break}return t.abrupt("return");case 2:return n=e.fileUserList.join(","),t.next=5,e.$http.getSendEmailUserList({userIds:n,type:e.ruleForm.subscribe?"subscribe":"all"});case 5:r=t.sent,r&&(e.userList=r,0==(null===(s=e.userList)||void 0===s?void 0:s.length)?e.$message.error("User does not exist,Please upload"):(e.sendAmount=null===r||void 0===r?void 0:r.length,e.dialogVisible=!0));case 7:case"end":return t.stop()}}),t)})))()},subscribeChange:function(e){this.getSendEmailUserListFunc()},getSendMailUserFunc:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function a(){var n,r,s;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=t.userPage,r=t.userSize,null!==e&&void 0!==e&&e.id&&(t.Id=e.id),console.log(t.Id),a.next=5,t.$http.getSendMailUser({id:t.Id,page:n,size:r});case 5:s=a.sent,s&&(t.userList=s.records,t.userTotal=s.total,t.dialogVisible=!0,t.showUserList=!0);case 7:case"end":return a.stop()}}),a)})))()},handleClose:function(){this.showUserList=!1,this.userPage=1},handleChange:function(e){var t,a=this,n=new FileReader;n.onload=function(e){var t=new Uint8Array(e.target.result),n=u.a.read(t,{type:"array"}),r=n.Sheets[n.SheetNames[0]],s=u.a.utils.sheet_to_json(r,{header:1});0!=(null===s||void 0===s?void 0:s.length)?a.fileUserList=s.map((function(e){return e[0]})):a.$message.error("Upload data to empty, please upload files with correct data formats")},n.readAsArrayBuffer(e.raw),null!==(t=this.fileUserList)&&void 0!==t&&t.length&&this.getSendEmailUserListFunc()},contentHandleChange:function(e){var t=this,a=new FileReader;a.onload=function(e){t.ruleForm.content=e.target.result},a.onerror=function(e){t.$message.error("File read error:"+event.target.error)},a.readAsText(e.raw)},submitForm:function(e){var t=this;this.$refs.ruleForm.validate(function(){var a=Object(l["a"])(Object(i["a"])().mark((function a(n){var r,s,o;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if("timing"!=e){a.next=5;break}return t.$set(t.rules,"sendTimeStr",t.rules.select),a.next=4,t.$refs.ruleForm.validateField(["sendTimeStr"],(function(e){n=!e}));case 4:a.sent;case 5:if(!n){a.next=16;break}if("part"!=t.ruleForm.sendUser){a.next=15;break}if(0!=(null===(r=t.fileUserList)||void 0===r?void 0:r.length)){a.next=12;break}return t.$message.error("Please upload the user list"),a.abrupt("return");case 12:if(0!=(null===(s=t.userList)||void 0===s?void 0:s.length)){a.next=15;break}return t.$message.error("Custom user data is empty, please upload it again!"),a.abrupt("return");case 15:t.sendAmount>t.remainingAmount?(o=t.$createElement,t.$confirm("Insufficient mailboxes.Whether to continue?","hint",{message:o("div",null,[o("p",null,"Insufficient mailboxes.Whether to continue? "),o("p",null,"Email quota:".concat(t.remainingAmount," ")),o("p",null,"Send quantity:".concat(t.sendAmount))]),confirmButtonText:"Sure",cancelButtonText:"Cancel",type:"warning"}).then(Object(l["a"])(Object(i["a"])().mark((function a(){return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.saveFunc(e);case 1:case"end":return a.stop()}}),a)}))))):t.saveFunc(e);case 16:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())},saveFunc:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function a(){var n,r;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e||(t.ruleForm.sendTimeStr=""),n=Object(s["a"])({},t.ruleForm),n.emailId=n.emailId.join(","),"part"==n.sendUser?n.sendUser=t.userList.map((function(e){return e.id})).join(","):n.sendUser=n.subscribe?"subscribe":"all",a.next=6,t.$http.sendEmailSave(Object(s["a"])({},n));case 6:r=a.sent,r&&(t.$message.success("Successful operation!"),t.getSendEmailListFunc(),t.$refs.ruleForm.resetFields(),t.fileUserList=[],t.userList=[]);case 8:case"end":return a.stop()}}),a)})))()},operatingFunc:function(e,t){var a=this;this.$confirm("Are you ".concat(" del "==t?" Delete ":" Cancel ","?"),"Tips",{confirmbuttontext:"OK",Cancelbuttext:"Cancel",Type:"Warning"}).then(Object(l["a"])(Object(i["a"])().mark((function n(){var r;return Object(i["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=null,"del"!=t){n.next=7;break}return n.next=4,a.$http.sendEmailDel({id:e.id});case 4:r=n.sent,n.next=10;break;case 7:return n.next=9,a.$http.sendEmailCancel({id:e.id,isCancel:0});case 9:r=n.sent;case 10:r&&(a.getSendEmailListFunc(),a.$message.success("Successful operation"));case 11:case"end":return n.stop()}}),n)})))).catch((function(e){console.error(e)}))},emailContentShow:function(e){this.emailContent=e,this.dialogVisible2=!0},handleSizeChange:function(e){this.size=e,this.getSendEmailListFunc()},handleCurrentChange:function(e){this.page=e,this.getSendEmailListFunc(!1)},handleSizeChangeUser:function(e){this.userSize=e,this.getSendMailUserFunc()},handleCurrentChangeUser:function(e){this.userPage=e,this.getSendMailUserFunc()}}},m=p,b=(a("8b3e"),a("2877")),f=Object(b["a"])(m,n,r,!1,null,"0e396618",null);t["default"]=f.exports},12:function(e,t){},13:function(e,t){},14:function(e,t){},"7bb2":function(e,t,a){},"8b3e":function(e,t,a){"use strict";a("7bb2")}}]);